import{s as Zt,a as Kt}from"./index-eToNCYVM.js";import{g as Jt,c as Qt}from"./data-B2GU3EJy.js";const H=4,W=4,K=4,R=new Int32Array(2),Ot=new Float32Array(R.buffer),Tt=new Float64Array(R.buffer),tt=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var gt;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(gt||(gt={}));class T{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new T(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return R[0]=this.readInt32(t),Ot[0]}readFloat64(t){return R[tt?0:1]=this.readInt32(t),R[tt?1:0]=this.readInt32(t+4),Tt[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){Ot[0]=e,this.writeInt32(t,R[0])}writeFloat64(t,e){Tt[0]=e,this.writeInt32(t,R[tt?0:1]),this.writeInt32(t+4,R[tt?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+H+W)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<W;e++)t+=String.fromCharCode(this.readInt8(this.position_+H+e));return t}__offset(t,e){const n=t-this.readInt32(t);return e<this.readInt16(n)?this.readInt16(n+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const n=this.readInt32(t);t+=H;const i=this.bytes_.subarray(t,t+n);return e===gt.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+H}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=W)throw new Error("FlatBuffers: file identifier must be length "+W);for(let e=0;e<W;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+H+e))return!1;return!0}createScalarList(t,e){const n=[];for(let i=0;i<e;++i){const s=t(i);s!==null&&n.push(s)}return n}createObjList(t,e){const n=[];for(let i=0;i<e;++i){const s=t(i);s!==null&&n.push(s.unpack())}return n}}var p,m=((p={})[p.Byte=0]="Byte",p[p.UByte=1]="UByte",p[p.Bool=2]="Bool",p[p.Short=3]="Short",p[p.UShort=4]="UShort",p[p.Int=5]="Int",p[p.UInt=6]="UInt",p[p.Long=7]="Long",p[p.ULong=8]="ULong",p[p.Float=9]="Float",p[p.Double=10]="Double",p[p.String=11]="String",p[p.Json=12]="Json",p[p.DateTime=13]="DateTime",p[p.Binary=14]="Binary",p);class w{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsColumn(t,e){return(e||new w).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,e){return t.setPosition(t.position()+K),(e||new w).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}type(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):m.Byte}title(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}width(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){let t=this.bb.__offset(this.bb_pos,18);return!t||!!this.bb.readInt8(this.bb_pos+t)}unique(){let t=this.bb.__offset(this.bb_pos,20);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}primaryKey(){let t=this.bb.__offset(this.bb_pos,22);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}metadata(t){let e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}static startColumn(t){t.startObject(11)}static addName(t,e){t.addFieldOffset(0,e,0)}static addType(t,e){t.addFieldInt8(1,e,m.Byte)}static addTitle(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWidth(t,e){t.addFieldInt32(4,e,-1)}static addPrecision(t,e){t.addFieldInt32(5,e,-1)}static addScale(t,e){t.addFieldInt32(6,e,-1)}static addNullable(t,e){t.addFieldInt8(7,+e,1)}static addUnique(t,e){t.addFieldInt8(8,+e,0)}static addPrimaryKey(t,e){t.addFieldInt8(9,+e,0)}static addMetadata(t,e){t.addFieldOffset(10,e,0)}static endColumn(t){let e=t.endObject();return t.requiredField(e,4),e}static createColumn(t,e,n,i,s,o,u,l,a,c,f,h){return w.startColumn(t),w.addName(t,e),w.addType(t,n),w.addTitle(t,i),w.addDescription(t,s),w.addWidth(t,o),w.addPrecision(t,u),w.addScale(t,l),w.addNullable(t,a),w.addUnique(t,c),w.addPrimaryKey(t,f),w.addMetadata(t,h),w.endColumn(t)}}var _,x=((_={})[_.Unknown=0]="Unknown",_[_.Point=1]="Point",_[_.LineString=2]="LineString",_[_.Polygon=3]="Polygon",_[_.MultiPoint=4]="MultiPoint",_[_.MultiLineString=5]="MultiLineString",_[_.MultiPolygon=6]="MultiPolygon",_[_.GeometryCollection=7]="GeometryCollection",_[_.CircularString=8]="CircularString",_[_.CompoundCurve=9]="CompoundCurve",_[_.CurvePolygon=10]="CurvePolygon",_[_.MultiCurve=11]="MultiCurve",_[_.MultiSurface=12]="MultiSurface",_[_.Curve=13]="Curve",_[_.Surface=14]="Surface",_[_.PolyhedralSurface=15]="PolyhedralSurface",_[_.TIN=16]="TIN",_[_.Triangle=17]="Triangle",_);class I{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometry(t,e){return(e||new I).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,e){return t.setPosition(t.position()+K),(e||new I).__init(t.readInt32(t.position())+t.position(),t)}ends(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}endsLength(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){let t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}xyLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}zLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){let t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}mLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){let t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}tLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){let t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+8*t):BigInt(0)}tmLength(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):x.Unknown}parts(t,e){let n=this.bb.__offset(this.bb_pos,18);return n?(e||new I).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}partsLength(){let t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,e){t.addFieldOffset(0,e,0)}static createEndsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addInt32(e[n]);return t.endVector()}static startEndsVector(t,e){t.startVector(4,e,4)}static addXy(t,e){t.addFieldOffset(1,e,0)}static createXyVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startXyVector(t,e){t.startVector(8,e,8)}static addZ(t,e){t.addFieldOffset(2,e,0)}static createZVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startZVector(t,e){t.startVector(8,e,8)}static addM(t,e){t.addFieldOffset(3,e,0)}static createMVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startMVector(t,e){t.startVector(8,e,8)}static addT(t,e){t.addFieldOffset(4,e,0)}static createTVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startTVector(t,e){t.startVector(8,e,8)}static addTm(t,e){t.addFieldOffset(5,e,0)}static createTmVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addInt64(e[n]);return t.endVector()}static startTmVector(t,e){t.startVector(8,e,8)}static addType(t,e){t.addFieldInt8(6,e,x.Unknown)}static addParts(t,e){t.addFieldOffset(7,e,0)}static createPartsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startPartsVector(t,e){t.startVector(4,e,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,e,n,i,s,o,u,l,a){return I.startGeometry(t),I.addEnds(t,e),I.addXy(t,n),I.addZ(t,i),I.addM(t,s),I.addT(t,o),I.addTm(t,u),I.addType(t,l),I.addParts(t,a),I.endGeometry(t)}}class U{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFeature(t,e){return(e||new U).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,e){return t.setPosition(t.position()+K),(e||new U).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){let e=this.bb.__offset(this.bb_pos,4);return e?(t||new I).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}properties(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}propertiesLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,e){let n=this.bb.__offset(this.bb_pos,8);return n?(e||new w).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}columnsLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,e){t.addFieldOffset(0,e,0)}static addProperties(t,e){t.addFieldOffset(1,e,0)}static createPropertiesVector(t,e){t.startVector(1,e.length,1);for(let n=e.length-1;n>=0;n--)t.addInt8(e[n]);return t.endVector()}static startPropertiesVector(t,e){t.startVector(1,e,1)}static addColumns(t,e){t.addFieldOffset(2,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,e){t.finish(e)}static finishSizePrefixedFeatureBuffer(t,e){t.finish(e,void 0,!0)}static createFeature(t,e,n,i){return U.startFeature(t),U.addGeometry(t,e),U.addProperties(t,n),U.addColumns(t,i),U.endFeature(t)}}const It=new Uint8Array(0);function te(){return this._source.cancel()}function ee(r,t){if(!r.length)return t;if(!t.length)return r;var e=new Uint8Array(r.length+t.length);return e.set(r),e.set(t,r.length),e}function re(){var r=this,t=r._array.subarray(r._index);return r._source.read().then(function(e){return r._array=It,r._index=0,e.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:ee(t,e.value)}})}function ne(r){if((r|=0)<0)throw new Error("invalid length");var t=this,e=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var n=new Uint8Array(r);return n.set(this._array.subarray(this._index)),(function i(){return t._source.read().then(function(s){return s.done?(t._array=It,t._index=0,e>0?n.subarray(0,e):null):e+s.value.length>=r?(t._array=s.value,t._index=r-e,n.set(s.value.subarray(0,r-e),e),n):(n.set(s.value,e),e+=s.value.length,i())})})()}function ie(r){return typeof r.slice=="function"?r:new lt(typeof r.read=="function"?r:r.getReader())}function lt(r){this._source=r,this._array=It,this._index=0}lt.prototype.read=re;lt.prototype.slice=ne;lt.prototype.cancel=te;const A=new Uint8Array([102,103,98,3,102,103,98,0]),P=4;class S{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCrs(t,e){return(e||new S).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,e){return t.setPosition(t.position()+K),(e||new S).__init(t.readInt32(t.position())+t.position(),t)}org(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}code(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}wkt(t){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}codeString(t){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,e){t.addFieldOffset(0,e,0)}static addCode(t,e){t.addFieldInt32(1,e,0)}static addName(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWkt(t,e){t.addFieldOffset(4,e,0)}static addCodeString(t,e){t.addFieldOffset(5,e,0)}static endCrs(t){return t.endObject()}static createCrs(t,e,n,i,s,o,u){return S.startCrs(t),S.addOrg(t,e),S.addCode(t,n),S.addName(t,i),S.addDescription(t,s),S.addWkt(t,o),S.addCodeString(t,u),S.endCrs(t)}}class it{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsHeader(t,e){return(e||new it).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,e){return t.setPosition(t.position()+K),(e||new it).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}envelope(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}envelopeLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):x.Unknown}hasZ(){let t=this.bb.__offset(this.bb_pos,10);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasM(){let t=this.bb.__offset(this.bb_pos,12);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasT(){let t=this.bb.__offset(this.bb_pos,14);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasTm(){let t=this.bb.__offset(this.bb_pos,16);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}columns(t,e){let n=this.bb.__offset(this.bb_pos,18);return n?(e||new w).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}columnsLength(){let t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){let t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){let t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){let e=this.bb.__offset(this.bb_pos,24);return e?(t||new S).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}title(t){let e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}metadata(t){let e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}static startHeader(t){t.startObject(14)}static addName(t,e){t.addFieldOffset(0,e,0)}static addEnvelope(t,e){t.addFieldOffset(1,e,0)}static createEnvelopeVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()}static startEnvelopeVector(t,e){t.startVector(8,e,8)}static addGeometryType(t,e){t.addFieldInt8(2,e,x.Unknown)}static addHasZ(t,e){t.addFieldInt8(3,+e,0)}static addHasM(t,e){t.addFieldInt8(4,+e,0)}static addHasT(t,e){t.addFieldInt8(5,+e,0)}static addHasTm(t,e){t.addFieldInt8(6,+e,0)}static addColumns(t,e){t.addFieldOffset(7,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static addFeaturesCount(t,e){t.addFieldInt64(8,e,BigInt("0"))}static addIndexNodeSize(t,e){t.addFieldInt16(9,e,16)}static addCrs(t,e){t.addFieldOffset(10,e,0)}static addTitle(t,e){t.addFieldOffset(11,e,0)}static addDescription(t,e){t.addFieldOffset(12,e,0)}static addMetadata(t,e){t.addFieldOffset(13,e,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,e){t.finish(e)}static finishSizePrefixedHeaderBuffer(t,e){t.finish(e,void 0,!0)}}function ht(r){let t=it.getRootAsHeader(r),e=t.featuresCount(),n=t.indexNodeSize(),i=[];for(let u=0;u<t.columnsLength();u++){let l=t.columns(u);if(!l)throw Error("Column unexpectedly missing");if(!l.name())throw Error("Column name unexpectedly missing");i.push({name:l.name(),type:l.type(),title:l.title(),description:l.description(),width:l.width(),precision:l.precision(),scale:l.scale(),nullable:l.nullable(),unique:l.unique(),primary_key:l.primaryKey()})}let s=t.crs(),o=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:t.geometryType(),columns:i,envelope:null,featuresCount:Number(e),indexNodeSize:n,crs:o,title:t.title(),description:t.description(),metadata:t.metadata()}}class ct{static global=new ct;_extraRequestThreshold=262144;extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(t){if(t<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=t}}const se=40,oe=16;function ft(r,t){t=Math.min(Math.max(+t,2),65535);let e=r,n=e;do n+=e=Math.ceil(e/t);while(e!==1);return 40*n}function ae(r,t){if(t<2)throw Error("Node size must be at least 2");if(r===0)throw Error("Number of items must be greater than 0");let e=r,n=e,i=[e];do n+=e=Math.ceil(e/t),i.push(e);while(e!==1);let s=[];for(let u of(e=n,i))s.push(e-u),e-=u;let o=[];for(let u=0;u<i.length;u++)o.push([s[u],s[u]+i[u]]);return o}async function*Dt(r,t,e,n){class i{_level;nodes;constructor(d,b){this._level=b,this.nodes=d}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(d){this.nodes[1]=d}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:s,minY:o,maxX:u,maxY:l}=e,a=ae(r,t),c=a[0][0],f=[new i([0,1],a.length-1)];for(;f.length!==0;){let h=f.shift(),d=h.startNodeIdx(),b=d>=c,y=(()=>{let[,E]=a[h.level()],v=Math.min(h.endNodeIdx()+t,E);return b&&v<E?v+1:v})(),F=y-d,O=new DataView(await n(40*d,40*F));for(let E=d;E<y;E++){let v=E-d,X=40*v;if(u<O.getFloat64(X+0,!0)||l<O.getFloat64(X+8,!0)||s>O.getFloat64(X+16,!0)||o>O.getFloat64(X+24,!0))continue;let M=O.getBigUint64(X+32,!0);if(b){let bt=(()=>{if(E<r-1){let Yt=(v+1)*40;return O.getBigUint64(Yt+32,!0)-M}return null})(),$t=E-c;yield[Number(M),$t,Number(bt)];continue}let Wt=ct.global.extraRequestThreshold()/40,k=f[f.length-1];if(k!==void 0&&k.level()===h.level()-1&&M<k.endNodeIdx()+Wt){k.extendEndNodeIdx(Number(M));continue}let Ut=(()=>{let bt=h.level()-1;return new i([Number(M),Number(M)+1],bt)})();k!==void 0&&(k.level(),Ut.level()),f.push(Ut)}}}class Ft{bytes;header;headerLength;indexLength;constructor(t,e,n,i){this.bytes=t,this.header=e,this.headerLength=n,this.indexLength=i}static open(t){if(!t.subarray(0,3).every((o,u)=>A[u]===o))throw Error("Not a FlatGeobuf file");let e=new DataView(t.buffer).getUint32(8,!0);if(e>10485760||e<8)throw Error("Invalid header size");let n=t.subarray(12,12+e),i=ht(new T(n)),s=ft(i.featuresCount,i.indexNodeSize);return new Ft(t,i,e,s)}async*selectBbox(t){let e=this.lengthBeforeTree(),n=async(i,s)=>{let o=e+i;return this.bytes.slice(o,o+s).buffer};for await(let i of Dt(this.header.featuresCount,this.header.indexNodeSize,t,n)){let[s,o]=i,u=this.readFeature(s);yield{id:o,feature:u}}}lengthBeforeTree(){return A.length+P+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}readFeature(t){let e=t+this.lengthBeforeFeatures(),n=new DataView(this.bytes.buffer).getUint32(e,!0),i=this.bytes.subarray(e+4,e+4+n),s=new Uint8Array(n+P);s.set(i,P);let o=new T(s);return o.setPosition(P),U.getRootAsFeature(o)}}var wt=function(r,t){return wt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])},wt(r,t)};function ue(r,t){wt(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function z(r,t,e,n){function i(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function u(c){try{a(n.next(c))}catch(f){o(f)}}function l(c){try{a(n.throw(c))}catch(f){o(f)}}function a(c){c.done?s(c.value):i(c.value).then(u,l)}a((n=n.apply(r,[])).next())})}function B(r,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(s=a[0]&2?i.return:a[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,a[1])).done)return s;switch(i=0,s&&(a=[a[0]&2,s.value]),a[0]){case 0:case 1:s=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,i=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){e.label=a[1];break}if(a[0]===6&&e.label<s[1]){e.label=s[1],s=a;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(a);break}s[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(r,e)}catch(c){a=[6,c],i=0}finally{n=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function j(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Z(r){return this instanceof Z?(this.v=r,this):new Z(r)}function le(r,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(r,t||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){n[h]&&(i[h]=function(d){return new Promise(function(b,y){s.push([h,d,b,y])>1||u(h,d)})})}function u(h,d){try{l(n[h](d))}catch(b){f(s[0][3],b)}}function l(h){h.value instanceof Z?Promise.resolve(h.value.v).then(a,c):f(s[0][2],h)}function a(h){u("next",h)}function c(h){u("throw",h)}function f(h,d){h(d),s.shift(),s.length&&u(s[0][0],s[0][1])}}var zt=(function(r){ue(t,r);function t(e){var n=r.call(this,e)||this;return Object.defineProperty(n,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(n,n.constructor.prototype):n.__proto__=n.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(n,n.constructor),n}return t})(Error);(function(){function r(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();(function(){function r(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();(function(){function r(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();function mt(r){r!=null&&typeof r.then=="function"&&r.then(at,at)}var _t=0,At=1,V=2,st=3,vt=4,ot=1024,at=function(){};function D(r){var t=r.err,e=Promise.resolve(r.execution).then(function(n){if(t!=null)throw t;return n});return r.err=void 0,r.execution=e.then(function(){},function(){}),r.pending===void 0?e:r.pending.then(function(){return e})}function L(r,t){var e=r.state>=st;return Promise.resolve(t).then(function(n){return!e&&r.state>=vt?D(r).then(function(i){return{value:i,done:!0}}):{value:n,done:e}})}function Et(r,t){var e,n;if(!(r.state>=V))if(r.state=V,r.onnext(),r.onstop(),r.err==null&&(r.err=t),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))Y(r);else try{for(var i=j(r.pushes),s=i.next();!s.done;s=i.next()){var o=s.value;o.resolve()}}catch(u){e={error:u}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}}function Y(r){var t,e;if(!(r.state>=st)){r.state<V&&Et(r),r.state=st,r.buffer=void 0;try{for(var n=j(r.nexts),i=n.next();!i.done;i=n.next()){var s=i.value,o=r.pending===void 0?D(r):r.pending.then(function(){return D(r)});s.resolve(L(r,o))}}catch(u){t={error:u}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}r.pushes=[],r.nexts=[]}}function Rt(r){r.state>=vt||(r.state<st&&Y(r),r.state=vt)}function he(r,t){if(mt(t),r.pushes.length>=ot)throw new zt("No more than "+ot+" pending calls to push are allowed on a single repeater.");if(r.state>=V)return Promise.resolve(void 0);var e=r.pending===void 0?Promise.resolve(t):r.pending.then(function(){return t});e=e.catch(function(l){r.state<V&&(r.err=l),Rt(r)});var n;if(r.nexts.length){var i=r.nexts.shift();i.resolve(L(r,e)),r.nexts.length?n=Promise.resolve(r.nexts[0].value):typeof r.buffer<"u"&&!r.buffer.full?n=Promise.resolve(void 0):n=new Promise(function(l){return r.onnext=l})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(e),n=Promise.resolve(void 0)):n=new Promise(function(l){return r.pushes.push({resolve:l,value:e})});var s=!0,o={},u=n.catch(function(l){if(s)throw l});return o.then=function(l,a){return s=!1,Promise.prototype.then.call(n,l,a)},o.catch=function(l){return s=!1,Promise.prototype.catch.call(n,l)},o.finally=n.finally.bind(n),r.pending=e.then(function(){return u}).catch(function(l){r.err=l,Rt(r)}),o}function ce(r){var t=Et.bind(null,r),e=new Promise(function(n){return r.onstop=n});return t.then=e.then.bind(e),t.catch=e.catch.bind(e),t.finally=e.finally.bind(e),t}function fe(r){if(!(r.state>=At)){r.state=At;var t=he.bind(null,r),e=ce(r);r.execution=new Promise(function(n){return n(r.executor(t,e))}),r.execution.catch(function(){return Et(r)})}}var et=new WeakMap,J=(function(){function r(t,e){et.set(this,{executor:t,buffer:e,err:void 0,state:_t,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:at,onstop:at})}return r.prototype.next=function(t){mt(t);var e=et.get(this);if(e===void 0)throw new Error("WeakMap error");if(e.nexts.length>=ot)throw new zt("No more than "+ot+" pending calls to next are allowed on a single repeater.");if(e.state<=_t&&fe(e),e.onnext(t),typeof e.buffer<"u"&&!e.buffer.empty){var n=L(e,e.buffer.remove());if(e.pushes.length){var i=e.pushes.shift();e.buffer.add(i.value),e.onnext=i.resolve}return n}else if(e.pushes.length){var s=e.pushes.shift();return e.onnext=s.resolve,L(e,s.value)}else if(e.state>=V)return Y(e),L(e,D(e));return new Promise(function(o){return e.nexts.push({resolve:o,value:t})})},r.prototype.return=function(t){mt(t);var e=et.get(this);if(e===void 0)throw new Error("WeakMap error");return Y(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),L(e,D(e))},r.prototype.throw=function(t){var e=et.get(this);if(e===void 0)throw new Error("WeakMap error");return e.state<=_t||e.state>=V||typeof e.buffer<"u"&&!e.buffer.empty?(Y(e),e.err==null&&(e.err=t),L(e,D(e))):this.next(Promise.reject(t))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=de,r.merge=be,r.zip=_e,r.latest=pe,r})();function dt(r,t){var e,n,i=[],s=function(a){a!=null&&typeof a[Symbol.asyncIterator]=="function"?i.push(a[Symbol.asyncIterator]()):a!=null&&typeof a[Symbol.iterator]=="function"?i.push(a[Symbol.iterator]()):i.push((function(){return le(this,arguments,function(){return B(this,function(h){switch(h.label){case 0:return t.yieldValues?[4,Z(a)]:[3,3];case 1:return[4,h.sent()];case 2:h.sent(),h.label=3;case 3:return t.returnValues?[4,Z(a)]:[3,5];case 4:return[2,h.sent()];case 5:return[2]}})})})())};try{for(var o=j(r),u=o.next();!u.done;u=o.next()){var l=u.value;s(l)}}catch(a){e={error:a}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return i}function de(r){var t=this,e=dt(r,{returnValues:!0});return new J(function(n,i){return z(t,void 0,void 0,function(){var s,o,u,l,a,c;return B(this,function(f){switch(f.label){case 0:if(!e.length)return i(),[2];o=!1,i.then(function(){s(),o=!0}),f.label=1;case 1:f.trys.push([1,,5,7]),l=void 0,a=0,c=function(){var h,d,b,y,F,O;return B(this,function(E){switch(E.label){case 0:h=a;try{for(d=(F=void 0,j(e)),b=d.next();!b.done;b=d.next())y=b.value,Promise.resolve(y.next()).then(function(v){v.done?(i(),u===void 0&&(u=v)):a===h&&(a++,s(v))},function(v){return i(v)})}catch(v){F={error:v}}finally{try{b&&!b.done&&(O=d.return)&&O.call(d)}finally{if(F)throw F.error}}return[4,new Promise(function(v){return s=v})];case 1:return l=E.sent(),l===void 0?[3,3]:[4,n(l.value)];case 2:E.sent(),E.label=3;case 3:return[2]}})},f.label=2;case 2:return o?[3,4]:[5,c()];case 3:return f.sent(),[3,2];case 4:return[2,u&&u.value];case 5:return i(),[4,Promise.race(e.map(function(h){return h.return&&h.return()}))];case 6:return f.sent(),[7];case 7:return[2]}})})})}function be(r){var t=this,e=dt(r,{yieldValues:!0});return new J(function(n,i){return z(t,void 0,void 0,function(){var s,o,u,l=this;return B(this,function(a){switch(a.label){case 0:if(!e.length)return i(),[2];s=[],o=!1,i.then(function(){var c,f;o=!0;try{for(var h=j(s),d=h.next();!d.done;d=h.next()){var b=d.value;b()}}catch(y){c={error:y}}finally{try{d&&!d.done&&(f=h.return)&&f.call(h)}finally{if(c)throw c.error}}}),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,Promise.all(e.map(function(c,f){return z(l,void 0,void 0,function(){var h,d;return B(this,function(b){switch(b.label){case 0:b.trys.push([0,,6,9]),b.label=1;case 1:return o?[3,5]:(Promise.resolve(c.next()).then(function(y){return s[f](y)},function(y){return i(y)}),[4,new Promise(function(y){s[f]=y})]);case 2:return h=b.sent(),h===void 0?[3,4]:h.done?(u=h,[2]):[4,n(h.value)];case 3:b.sent(),b.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return d=c.return,d?[4,c.return()]:[3,8];case 7:d=b.sent(),b.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return a.sent(),[2,u&&u.value];case 3:return i(),[7];case 4:return[2]}})})})}function _e(r){var t=this,e=dt(r,{returnValues:!0});return new J(function(n,i){return z(t,void 0,void 0,function(){var s,o,u,l;return B(this,function(a){switch(a.label){case 0:if(!e.length)return i(),[2,[]];o=!1,i.then(function(){s(),o=!0}),a.label=1;case 1:a.trys.push([1,,6,8]),a.label=2;case 2:return o?[3,5]:(Promise.all(e.map(function(c){return c.next()})).then(function(c){return s(c)},function(c){return i(c)}),[4,new Promise(function(c){return s=c})]);case 3:return u=a.sent(),u===void 0?[2]:(l=u.map(function(c){return c.value}),u.some(function(c){return c.done})?[2,l]:[4,n(l)]);case 4:return a.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(e.map(function(c){return c.return&&c.return()}))];case 7:return a.sent(),[7];case 8:return[2]}})})})}function pe(r){var t=this,e=dt(r,{yieldValues:!0,returnValues:!0});return new J(function(n,i){return z(t,void 0,void 0,function(){var s,o,u,l,a,c=this;return B(this,function(f){switch(f.label){case 0:if(!e.length)return i(),[2,[]];o=[],u=!1,i.then(function(){var h,d;s();try{for(var b=j(o),y=b.next();!y.done;y=b.next()){var F=y.value;F()}}catch(O){h={error:O}}finally{try{y&&!y.done&&(d=b.return)&&d.call(b)}finally{if(h)throw h.error}}u=!0}),f.label=1;case 1:return f.trys.push([1,,5,7]),Promise.all(e.map(function(h){return h.next()})).then(function(h){return s(h)},function(h){return i(h)}),[4,new Promise(function(h){return s=h})];case 2:return l=f.sent(),l===void 0?[2]:(a=l.map(function(h){return h.value}),l.every(function(h){return h.done})?[2,a]:[4,n(a.slice())]);case 3:return f.sent(),[4,Promise.all(e.map(function(h,d){return z(c,void 0,void 0,function(){var b;return B(this,function(y){switch(y.label){case 0:if(l[d].done)return[2,l[d].value];y.label=1;case 1:return u?[3,4]:(Promise.resolve(h.next()).then(function(F){return o[d](F)},function(F){return i(F)}),[4,new Promise(function(F){return o[d]=F})]);case 2:return b=y.sent(),b===void 0?[2,l[d].value]:b.done?[2,b.value]:(a[d]=b.value,[4,n(a.slice())]);case 3:return y.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,f.sent()];case 5:return i(),[4,Promise.all(e.map(function(h){return h.return&&h.return()}))];case 6:return f.sent(),[7];case 7:return[2]}})})})}class Pt{headerClient;header;headerLength;indexLength;nocache;headers;constructor(t,e,n,i,s,o={}){this.headerClient=t,this.header=e,this.headerLength=n,this.indexLength=i,this.nocache=s,this.headers=o}static async open(t,e,n={}){let i,s=new Bt(t,e,n),o=2024+(()=>{let c,f=0;for(c=0;c<3;c++)f+=oe**c*se;return f})();if(!new Uint8Array(await s.getRange(0,8,o,"header")).subarray(0,3).every((c,f)=>A[f]===c))throw Error("Not a FlatGeobuf file");if((i=new DataView(await s.getRange(8,4,o,"header")).getUint32(0,!0))>10485760||i<8)throw Error("Invalid header size");let u=await s.getRange(12,i,o,"header"),l=ht(new T(new Uint8Array(u)));if(l.indexNodeSize===0)throw Error("No index found, cannot read features filtered by bbox");let a=ft(l.featuresCount,l.indexNodeSize);return new Pt(s,l,i,a,e,n)}async*selectBbox(t){let e=this.lengthBeforeTree(),n=this.headerClient,i=async(l,a)=>n.getRange(e+l,a,0,"index"),s=[],o=[];for await(let l of Dt(this.header.featuresCount,this.header.indexNodeSize,t,i)){let[a,c]=l,[,,f]=l;if(f||(f=4),o.length===0){o.push([a,f,c]);continue}let h=o[o.length-1];a-(h[0]+h[1])>ct.global.extraRequestThreshold()&&(s.push(o),o=[]),o.push([a,f,c])}this.headerClient.logUsage("header+index"),o.length>0&&s.push(o);let u=s.flatMap(l=>this.readFeatureBatch(l,this.nocache));yield*J.merge(u)}lengthBeforeTree(){return A.length+P+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new Bt(this.headerClient.httpClient,t,this.headers)}async*readFeatureBatch(t,e){let[n]=t[0],[i,s]=t[t.length-1],o=this.buildFeatureClient(e),u=i+s-n;for(let[l,,a]of t){let c=await this.readFeature(o,l,u);yield{id:a,feature:c},u=0}o.logUsage("feature")}async readFeature(t,e,n){let i,s=e+this.lengthBeforeFeatures();i=new DataView(await t.getRange(s,4,n,"feature length")).getUint32(0,!0);let o=new Uint8Array(await t.getRange(s+4,i,n,"feature data")),u=new Uint8Array(i+P);u.set(o,P);let l=new T(u);return l.setPosition(P),U.getRootAsFeature(l)}}class Bt{httpClient;bytesEverUsed=0;bytesEverFetched=0;buffer=new ArrayBuffer(0);head=0;constructor(t,e,n={}){if(typeof t=="string")this.httpClient=new Ct(t,e,n);else if(t instanceof Ct)this.httpClient=t;else throw Error("Unknown source")}async getRange(t,e,n,i){this.bytesEverUsed+=e;let s=t-this.head,o=s+e;if(s>=0&&o<=this.buffer.byteLength)return this.buffer.slice(s,o);let u=Math.max(e,n);return this.bytesEverFetched+=u,this.buffer=await this.httpClient.getRange(t,u,i),this.head=t,this.buffer.slice(0,e)}logUsage(t){t.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class Ct{url;nocache;headers;requestsEverMade=0;bytesEverRequested=0;constructor(t,e,n={}){this.url=t,this.nocache=e,this.headers=n}async getRange(t,e,n){this.requestsEverMade+=1,this.bytesEverRequested+=e;let i=`bytes=${t}-${t+e-1}`,s=new Headers(this.headers);return s.set("Range",i),this.nocache&&s.set("Cache-Control","no-cache, no-store"),await(await fetch(this.url,{headers:s})).arrayBuffer()}}function pt(r,t){let e=[];for(let n=0;n<r.length;n+=2){let i=[r[n],r[n+1]];t&&i.push(t[n>>1]),e.push(i)}return e}new TextEncoder;let Nt=new TextDecoder;function ye(r,t){let e={};if(!t||t.length===0)return e;let n=r.propertiesArray();if(!n)return e;let i=new DataView(n.buffer,n.byteOffset),s=r.propertiesLength(),o=0;for(;o<s;){let u=i.getUint16(o,!0);o+=2;let l=t[u],a=l.name;switch(l.type){case m.Bool:e[a]=!!i.getUint8(o),o+=1;break;case m.Byte:e[a]=i.getInt8(o),o+=1;break;case m.UByte:e[a]=i.getUint8(o),o+=1;break;case m.Short:e[a]=i.getInt16(o,!0),o+=2;break;case m.UShort:e[a]=i.getUint16(o,!0),o+=2;break;case m.Int:e[a]=i.getInt32(o,!0),o+=4;break;case m.UInt:e[a]=i.getUint32(o,!0),o+=4;break;case m.Long:e[a]=Number(i.getBigInt64(o,!0)),o+=8;break;case m.ULong:e[a]=Number(i.getBigUint64(o,!0)),o+=8;break;case m.Float:e[a]=i.getFloat32(o,!0),o+=4;break;case m.Double:e[a]=i.getFloat64(o,!0),o+=8;break;case m.DateTime:case m.String:{let c=i.getUint32(o,!0);o+=4,e[a]=Nt.decode(n.subarray(o,o+c)),o+=c;break}case m.Json:{let c=i.getUint32(o,!0);o+=4;let f=Nt.decode(n.subarray(o,o+c));e[a]=JSON.parse(f),o+=c;break}case m.Binary:{let c=i.getUint32(o,!0);o+=4,e[a]=n.subarray(o,o+c),o+=c;break}default:throw Error(`Unknown type ${l.type}`)}}return e}async function*ge(r,t,e,n){if(!r.subarray(0,3).every((f,h)=>A[h]===f))throw Error("Not a FlatGeobuf file");if(e){let f=Ft.open(r);for await(let h of f.selectBbox(e))yield t(h.id,h.feature,f.header);return}let i=new T(r),s=i.readUint32(A.length);i.setPosition(A.length+P);let o=ht(i),u=A.length+P+s,{indexNodeSize:l,featuresCount:a}=o;l>0&&(u+=ft(a,l));let c=0;for(;u<i.capacity();){let f=i.readUint32(u);i.setPosition(u+P);let h=U.getRootAsFeature(i);yield t(c++,h,o),u+=P+f}}async function*we(r,t,e){let n,i=ie(r),s=async d=>await i.slice(d),o=new Uint8Array(await s(8));if(!o.subarray(0,3).every((d,b)=>A[b]===d))throw Error("Not a FlatGeobuf file");o=new Uint8Array(await s(4));let u=new T(o),l=u.readUint32(0);o=new Uint8Array(await s(l));let a=ht(u=new T(o)),{indexNodeSize:c,featuresCount:f}=a;if(c>0){let d=ft(f,c);await s(d)}let h=0;for(;n=await ve(s,a,t,h++);)yield n}async function*me(r,t,e,n,i=!1,s={}){let o=await Pt.open(r,i,s);for await(let u of o.selectBbox(t))yield e(u.id,u.feature,o.header)}async function ve(r,t,e,n){let i=new Uint8Array(await r(4,"feature length"));if(i.byteLength===0)return;let s=new T(i),o=s.readUint32(0);i=new Uint8Array(await r(o,"feature data"));let u=new Uint8Array(o+4);return u.set(i,4),(s=new T(u)).setPosition(P),e(n,U.getRootAsFeature(s),t)}function xt(r,t){let e=t;if(e===x.Unknown&&(e=r.type()),e===x.GeometryCollection){let i=[];for(let s=0;s<r.partsLength();s++){let o=r.parts(s),u=o.type();i.push(xt(o,u))}return{type:x[e],geometries:i}}if(e===x.MultiPolygon){let i=[];for(let s=0;s<r.partsLength();s++)i.push(xt(r.parts(s),x.Polygon));return{type:x[e],coordinates:i.map(s=>s.coordinates)}}let n=(function(i,s){let o=i.xyArray(),u=i.zArray();switch(s){case x.Point:{let l=Array.from(o);return u&&l.push(u[0]),l}case x.MultiPoint:case x.LineString:return pt(o,u);case x.MultiLineString:case x.Polygon:return(function(l,a,c){let f;if(!c||c.length===0)return[pt(l,a)];let h=0,d=Array.from(c).map(b=>l.slice(h,h=b<<1));return a&&(h=0,f=Array.from(c).map(b=>a.slice(h,h=b))),d.map((b,y)=>pt(b,f?f[y]:void 0))})(o,u,i.endsArray())}})(r,e);return{type:x[e],coordinates:n}}function St(r,t,e){let n=e.columns;return{type:"Feature",id:r,geometry:xt(t.geometry(),e.geometryType),properties:ye(t,n)}}async function*xe(r,t,e){yield*ge(r,St,t)}function Ie(r,t){return we(r,St)}function Fe(r,t,e,n=!1,i={}){return me(r,t,St,e,n,i)}function Ee(r,t,e,n=!1,i={}){return r instanceof Uint8Array?xe(r,t):r instanceof ReadableStream?Ie(r):Fe(r,t,e,n,i)}const Pe={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class jt{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Pe[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Q=6378137,q=Math.PI*Q,Se=[-q,-q,q,q],Ue=[-180,-85,180,85],rt=Q*Math.log(Math.tan(Math.PI/2));class G extends jt{constructor(t){super({code:t,units:"m",extent:Se,global:!0,worldExtent:Ue,getPointResolution:function(e,n){return e/Math.cosh(n[1]/Q)}})}}const Lt=[new G("EPSG:3857"),new G("EPSG:102100"),new G("EPSG:102113"),new G("EPSG:900913"),new G("http://www.opengis.net/def/crs/EPSG/0/3857"),new G("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Oe(r,t,e,n){const i=r.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=r.slice():t=new Array(i));for(let s=0;s<i;s+=n){t[s]=q*r[s]/180;let o=Q*Math.log(Math.tan(Math.PI*(+r[s+1]+90)/360));o>rt?o=rt:o<-rt&&(o=-rt),t[s+1]=o}return t}function Te(r,t,e,n){const i=r.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=r.slice():t=new Array(i));for(let s=0;s<i;s+=n)t[s]=180*r[s]/q,t[s+1]=360*Math.atan(Math.exp(r[s+1]/Q))/Math.PI-90;return t}const Ae=6378137,Vt=[-180,-90,180,90],Re=Math.PI*Ae/180;class C extends jt{constructor(t,e){super({code:t,units:"degrees",extent:Vt,axisOrientation:e,global:!0,metersPerUnit:Re,worldExtent:Vt})}}const Mt=[new C("CRS:84"),new C("EPSG:4326","neu"),new C("urn:ogc:def:crs:OGC:1.3:CRS84"),new C("urn:ogc:def:crs:OGC:2:84"),new C("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new C("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new C("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let yt={};function ut(r,t,e){const n=r.getCode(),i=t.getCode();n in yt||(yt[n]={}),yt[n][i]=e}function Xt(r,t){if(t!==void 0){for(let e=0,n=r.length;e<n;++e)t[e]=r[e];t=t}else t=r.slice();return t}function Be(r){r.getCode(),ut(r,r,Xt)}function Ce(r){r.forEach(Be)}function kt(r){Ce(r),r.forEach(function(t){r.forEach(function(e){t!==e&&ut(t,e,Xt)})})}function Ne(r,t,e,n){r.forEach(function(i){t.forEach(function(s){ut(i,s,e),ut(s,i,n)})})}function Le(){kt(Lt),kt(Mt),Ne(Mt,Lt,Oe,Te)}Le();Zt();const Ve=Jt("flatgeobuf"),N="roofsSource",nt="rectangleSource",$="roofs-fill",Me=["case",["==",["to-number",["get","KLASSE"]],0],"#cccccc",["==",["to-number",["get","KLASSE"]],1],"#00c5ff",["==",["to-number",["get","KLASSE"]],2],"#ffff00",["==",["to-number",["get","KLASSE"]],3],"#ffaa00",["==",["to-number",["get","KLASSE"]],4],"#ff5500",["==",["to-number",["get","KLASSE"]],5],"#a80000","#000000"],g=Qt({initialZoom:15,minZoom:15,initialPosition:{lat:47.36523,lon:8.55015}}),Ht=()=>{const{lng:r,lat:t}=g.getCenter(),{_ne:e}=g.getBounds(),n=Math.min(e.lng-r,e.lat-t)*.8;return{minX:r-n,minY:t-n,maxX:r+n,maxY:t+n}},Gt=()=>{const r=Ht();return{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[r.minX,r.minY],[r.maxX,r.minY],[r.maxX,r.maxY],[r.minX,r.maxY],[r.minX,r.minY]]]},properties:[]}]}},qt=async()=>{let r=0;const t={type:"FeatureCollection",features:[]},e=Ee(Ve,Ht());for await(const n of e)t.features.push({...n,id:r}),r+=1;g.getSource(N).setData(t)};g.on("load",async()=>{g.addSource(N,{type:"geojson",data:{type:"FeatureCollection",features:[]},attribution:"©Bundesamt für Energie BFE"}),g.addLayer({id:$,type:"fill",source:N,paint:{"fill-color":Me}}),g.addLayer({id:"roofs-outline",type:"line",source:N,paint:{"line-color":"#000000","line-opacity":["case",["boolean",["feature-state","hover"],!1],1,0],"line-width":1}}),g.addSource(nt,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),g.addLayer({id:"rectangle",type:"line",source:nt,paint:{"line-color":"#0000FF","line-opacity":.9,"line-width":3}}),g.getSource(nt).setData(Gt()),g.on("click",$,t=>{Kt(t.features?.[0]?.properties)});let r;g.on("mousemove",$,t=>{t.features&&t.features.length>0&&(r!==void 0&&g.setFeatureState({source:N,id:r},{hover:!1}),r=t.features[0].id,g.setFeatureState({source:N,id:r},{hover:!0}))}),g.on("mouseenter",$,()=>{g.getCanvas().style.cursor="pointer"}),g.on("mouseleave",$,()=>{g.getCanvas().style.cursor="",r!==void 0&&g.setFeatureState({source:N,id:r},{hover:!1}),r=void 0}),g.on("moveend",async()=>{g.getSource(nt).setData(Gt()),await qt()}),await qt()});
