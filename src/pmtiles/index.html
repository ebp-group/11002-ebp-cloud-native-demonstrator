<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cloud-Native Geospatial Demonstrator</title>
    <script type="module" src="../shared/index.ts"></script>
    <script type="module" src="./main.ts"></script>
  </head>
  <body>
    <div class="container-fluid h-100">
      <div class="row h-100">
        <div class="col-6 p-0">
          <div id="map" class="h-100"></div>
        </div>
        <div class="col-6 p-4 h-100 d-flex flex-column">
          <a href="../../">&leftarrow;Back to start</a>
          <h1 class="display-1">PMTiles</h1>
          <div class="alert alert-info">
            <b>Feature data at mouse click:</b>&nbsp;
            <pre><code id="clickresult">none</code></pre>
            <p>
              <button id="clearResults" class="btn btn-primary">Clear</button>
            </p>

            <p></p>
            <p>
              <small>Amount of features visible per layer: <span id="layerCount"></span></small>
            </p>
          </div>
          <div class="overflow-auto">
            <h2 class="display-6">General</h2>
            <ul>
              <li>
                Datasource:
                <a href="https://overturemaps-tiles-us-west-2-beta.s3.amazonaws.com/2025-04-23/divisions.pmtiles" target="_blank"
                  >Ouverture Maps Foundation (Dataset <i>Divisions, 2025-04-23</i></a
                >
              </li>
              <li>Additional library needed: <a href="https://www.npmjs.com/package/pmtiles" target="_blank">pmtiles</a></li>
              <li>Datafile is roughly 10GB, see network tab to see the rangerequests in action.</li>
            </ul>
            <hr />
            <h2 class="display-6">Things to note</h2>
            <p>
              Currently, we only visualize subtypes <code>country</code> and <code>region</code> (see
              <a href="https://docs.overturemaps.org/guides/divisions/#subtype-descriptions" target="_blank">Overture docs</a> for more
              available types). The rendering is simple in that countries are visualized as polygons and a solid outline, whereas regions
              are visualized as transparent polygons with dashed outlines. This is the standard way of doing vector visualization in
              <code>maplibregl</code>, since WebGL does not offer styling mechanisms for outlines (see
              <a href="https://github.com/mapbox/mapbox-gl-js/issues/3018" target="_blank">mapbox-gl-js#3018</a>).
            </p>
            <p>
              Due to how the Pmtiles file was generated by the provider, layers do not have features visible at all zoom levels. Hence, you
              need to scroll in to be able to see the regions; and additionally, you only get the full information depth if you zoom in far
              enough. This showcases how the file size of a Pmtiles dataset can be reduced, by either setting the zoom level to a sensible
              minimum (e.g. there is no point to display regions on a global scale) or by removing the information amount per feature on a
              higher level (since adding all metadata on all zoom levels bloats the Pmtiles file).
            </p>
            <p>
              As is evident, the <code>division_id</code> property of the data sets could be used to query the actual datasets, which exist
              in GeoParquet formats. This <i>could</i> be done using
              <a href="https://duckdb.org/docs/stable/clients/wasm/overview" target="_blank">DuckDB WASM</a>, but it would require
              self-hosting the data, since <code>DuckDB WASM</code> currently does not support the <code>httpfs</code> library and so, the
              provided S3 partitions cannot be consumed. If you were to download this, you can use a normal DuckDB client and query like so:
            </p>
            <pre><code class="sql">COPY(
   SELECT
     *
   FROM
     read_parquet('s3://overturemaps-us-west-2/release/2025-11-19.0/theme=divisions/type=division_area/*')
   WHERE subtype IN ('country', 'region')
 ) TO 'divisions.parquet';</code></pre>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
