import{s as Ke,m as We,a as Je}from"./index-BZQIEhfr.js";import{g as Ve,c as Ge}from"./data-2xGwnY61.js";var w=Uint8Array,z=Uint16Array,Ye=Int32Array,Le=new w([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Te=new w([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qe=new w([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ee=function(r,t){for(var e=new z(31),n=0;n<31;++n)e[n]=t+=1<<r[n-1];for(var i=new Ye(e[30]),n=1;n<30;++n)for(var a=e[n];a<e[n+1];++a)i[a]=a-e[n]<<5|n;return{b:e,r:i}},Ue=Ee(Le,2),Ce=Ue.b,Qe=Ue.r;Ce[28]=258,Qe[258]=28;var Xe=Ee(Te,0),et=Xe.b,ee=new z(32768);for(var g=0;g<32768;++g){var A=(g&43690)>>1|(g&21845)<<1;A=(A&52428)>>2|(A&13107)<<2,A=(A&61680)>>4|(A&3855)<<4,ee[g]=((A&65280)>>8|(A&255)<<8)>>1}var _=(function(r,t,e){for(var n=r.length,i=0,a=new z(t);i<n;++i)r[i]&&++a[r[i]-1];var o=new z(t);for(i=1;i<t;++i)o[i]=o[i-1]+a[i-1]<<1;var s;if(e){s=new z(1<<t);var f=15-t;for(i=0;i<n;++i)if(r[i])for(var c=i<<4|r[i],h=t-r[i],l=o[r[i]-1]++<<h,u=l|(1<<h)-1;l<=u;++l)s[ee[l]>>f]=c}else for(s=new z(n),i=0;i<n;++i)r[i]&&(s[i]=ee[o[r[i]-1]++]>>15-r[i]);return s}),k=new w(288);for(var g=0;g<144;++g)k[g]=8;for(var g=144;g<256;++g)k[g]=9;for(var g=256;g<280;++g)k[g]=7;for(var g=280;g<288;++g)k[g]=8;var Me=new w(32);for(var g=0;g<32;++g)Me[g]=5;var tt=_(k,9,1),rt=_(Me,5,1),Q=function(r){for(var t=r[0],e=1;e<r.length;++e)r[e]>t&&(t=r[e]);return t},T=function(r,t,e){var n=t/8|0;return(r[n]|r[n+1]<<8)>>(t&7)&e},X=function(r,t){var e=t/8|0;return(r[e]|r[e+1]<<8|r[e+2]<<16)>>(t&7)},nt=function(r){return(r+7)/8|0},it=function(r,t,e){return(e==null||e>r.length)&&(e=r.length),new w(r.subarray(t,e))},at=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],p=function(r,t,e){var n=new Error(t||at[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,p),!e)throw n;return n},ie=function(r,t,e,n){var i=r.length,a=0;if(!i||t.f&&!t.l)return e||new w(0);var o=!e,s=o||t.i!=2,f=t.i;o&&(e=new w(i*3));var c=function(me){var pe=e.length;if(me>pe){var we=new w(Math.max(pe*2,me));we.set(e),e=we}},h=t.f||0,l=t.p||0,u=t.b||0,m=t.l,U=t.d,v=t.m,R=t.n,j=i*8;do{if(!m){h=T(r,l,1);var N=T(r,l+1,3);if(l+=3,N)if(N==1)m=tt,U=rt,v=9,R=5;else if(N==2){var J=T(r,l,31)+257,ce=T(r,l+10,15)+4,ue=J+T(r,l+5,31)+1;l+=14;for(var I=new w(ue),V=new w(19),b=0;b<ce;++b)V[qe[b]]=T(r,l+b*3,7);l+=ce*3;for(var he=Q(V),Ze=(1<<he)-1,Be=_(V,he,1),b=0;b<ue;){var fe=Be[T(r,l,Ze)];l+=fe&15;var C=fe>>4;if(C<16)I[b++]=C;else{var D=0,Z=0;for(C==16?(Z=3+T(r,l,3),l+=2,D=I[b-1]):C==17?(Z=3+T(r,l,7),l+=3):C==18&&(Z=11+T(r,l,127),l+=7);Z--;)I[b++]=D}}var de=I.subarray(0,J),M=I.subarray(J);v=Q(de),R=Q(M),m=_(de,v,1),U=_(M,R,1)}else p(1);else{var C=nt(l)+4,K=r[C-4]|r[C-3]<<8,W=C+K;if(W>i){f&&p(0);break}s&&c(u+K),e.set(r.subarray(C,W),u),t.b=u+=K,t.p=l=W*8,t.f=h;continue}if(l>j){f&&p(0);break}}s&&c(u+131072);for(var Fe=(1<<v)-1,je=(1<<R)-1,G=l;;G=l){var D=m[X(r,l)&Fe],O=D>>4;if(l+=D&15,l>j){f&&p(0);break}if(D||p(2),O<256)e[u++]=O;else if(O==256){G=l,m=null;break}else{var ge=O-254;if(O>264){var b=O-257,H=Le[b];ge=T(r,l,(1<<H)-1)+Ce[b],l+=H}var Y=U[X(r,l)&je],q=Y>>4;Y||p(3),l+=Y&15;var M=et[q];if(q>3){var H=Te[q];M+=X(r,l)&(1<<H)-1,l+=H}if(l>j){f&&p(0);break}s&&c(u+131072);var ve=u+ge;if(u<M){var ye=a-M,Ne=Math.min(M,ve);for(ye+u<0&&p(3);u<Ne;++u)e[u]=n[ye+u]}for(;u<ve;++u)e[u]=e[u-M]}}t.l=m,t.p=G,t.b=u,t.f=h,m&&(h=1,t.m=v,t.d=U,t.n=R)}while(!h);return u!=e.length&&o?it(e,0,u):e.subarray(0,u)},ot=new w(0),st=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&p(6,"invalid gzip data");var t=r[3],e=10;t&4&&(e+=(r[10]|r[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!r[e++]);return e+(t&2)},lt=function(r){var t=r.length;return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0},ct=function(r,t){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&p(6,"invalid zlib data"),(r[1]>>5&1)==1&&p(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function ut(r,t){return ie(r,{i:2},t,t)}function ht(r,t){var e=st(r);return e+8>r.length&&p(6,"invalid gzip data"),ie(r.subarray(e,-8),{i:2},new w(lt(r)),t)}function ft(r,t){return ie(r.subarray(ct(r),-4),{i:2},t,t)}function dt(r,t){return r[0]==31&&r[1]==139&&r[2]==8?ht(r,t):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?ut(r,t):ft(r,t)}var gt=typeof TextDecoder<"u"&&new TextDecoder,vt=0;try{gt.decode(ot,{stream:!0}),vt=1}catch{}var yt=Object.defineProperty,$=Math.pow,d=(r,t)=>yt(r,"name",{value:t,configurable:!0}),y=(r,t,e)=>new Promise((n,i)=>{var a=f=>{try{s(e.next(f))}catch(c){i(c)}},o=f=>{try{s(e.throw(f))}catch(c){i(c)}},s=f=>f.done?n(f.value):Promise.resolve(f.value).then(a,o);s((e=e.apply(r,t)).next())});d((r,t)=>{let e=!1,n="",i=L.GridLayer.extend({createTile:d((a,o)=>{let s=document.createElement("img"),f=new AbortController,c=f.signal;return s.cancel=()=>{f.abort()},e||(r.getHeader().then(h=>{h.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):h.tileType===2?n="image/png":h.tileType===3?n="image/jpeg":h.tileType===4?n="image/webp":h.tileType===5&&(n="image/avif")}),e=!0),r.getZxy(a.z,a.x,a.y,c).then(h=>{if(h){let l=new Blob([h.data],{type:n}),u=window.URL.createObjectURL(l);s.src=u,s.cancel=void 0,o(void 0,s)}}).catch(h=>{if(h.name!=="AbortError")throw h}),s},"createTile"),_removeTile:d(function(a){let o=this._tiles[a];o&&(o.el.cancel&&o.el.cancel(),o.el.width=0,o.el.height=0,o.el.deleted=!0,L.DomUtil.remove(o.el),delete this._tiles[a],this.fire("tileunload",{tile:o.el,coords:this._keyToTileCoords(a)}))},"_removeTile")});return new i(t)},"leafletRasterLayer");var mt=d(r=>(t,e)=>{if(e instanceof AbortController)return r(t,e);let n=new AbortController;return r(t,n).then(i=>e(void 0,i.data,i.cacheControl||"",i.expires||""),i=>e(i)).catch(i=>e(i)),{cancel:d(()=>n.abort(),"cancel")}},"v3compat"),Ae=class{constructor(t){this.tilev4=d((e,n)=>y(this,null,function*(){if(e.type==="json"){let m=e.url.substr(10),U=this.tiles.get(m);if(U||(U=new be(m),this.tiles.set(m,U)),this.metadata)return{data:yield U.getTileJson(e.url)};let v=yield U.getHeader();return(v.minLon>=v.maxLon||v.minLat>=v.maxLat)&&console.error(`Bounds of PMTiles archive ${v.minLon},${v.minLat},${v.maxLon},${v.maxLat} are not valid.`),{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:v.minZoom,maxzoom:v.maxZoom,bounds:[v.minLon,v.minLat,v.maxLon,v.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),a=e.url.match(i);if(!a)throw new Error("Invalid PMTiles protocol URL");let o=a[1],s=this.tiles.get(o);s||(s=new be(o),this.tiles.set(o,s));let f=a[2],c=a[3],h=a[4],l=yield s.getHeader(),u=yield s?.getZxy(+f,+c,+h,n.signal);if(u)return{data:new Uint8Array(u.data),cacheControl:u.cacheControl,expires:u.expires};if(l.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=mt(this.tilev4),this.tiles=new Map,this.metadata=t?.metadata||!1,this.errorOnMissingTile=t?.errorOnMissingTile||!1}add(t){this.tiles.set(t.source.getKey(),t)}get(t){return this.tiles.get(t)}};d(Ae,"Protocol");var pt=Ae;function De(r,t){return(t>>>0)*4294967296+(r>>>0)}d(De,"toNum");function Oe(r,t){let e=t.buf,n=e[t.pos++],i=(n&112)>>4;if(n<128||(n=e[t.pos++],i|=(n&127)<<3,n<128)||(n=e[t.pos++],i|=(n&127)<<10,n<128)||(n=e[t.pos++],i|=(n&127)<<17,n<128)||(n=e[t.pos++],i|=(n&127)<<24,n<128)||(n=e[t.pos++],i|=(n&1)<<31,n<128))return De(r,i);throw new Error("Expected varint not more than 10 bytes")}d(Oe,"readVarintRemainder");function S(r){let t=r.buf,e=t[r.pos++],n=e&127;return e<128||(e=t[r.pos++],n|=(e&127)<<7,e<128)||(e=t[r.pos++],n|=(e&127)<<14,e<128)||(e=t[r.pos++],n|=(e&127)<<21,e<128)?n:(e=t[r.pos],n|=(e&15)<<28,Oe(n,r))}d(S,"readVarint");function ae(r,t,e,n){if(n===0){e===1&&(t[0]=r-1-t[0],t[1]=r-1-t[1]);let i=t[0];t[0]=t[1],t[1]=i}}d(ae,"rotate");function Se(r,t){let e=$(2,r),n=t,i=t,a=t,o=[0,0],s=1;for(;s<e;)n=1&a/2,i=1&(a^n),ae(s,o,n,i),o[0]+=s*n,o[1]+=s*i,a=a/4,s*=2;return[r,o[0],o[1]]}d(Se,"idOnLevel");var wt=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function ze(r,t,e){if(r>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(t>$(2,r)-1||e>$(2,r)-1)throw new Error("tile x/y outside zoom level bounds");let n=wt[r],i=$(2,r),a=0,o=0,s=0,f=[t,e],c=i/2;for(;c>0;)a=(f[0]&c)>0?1:0,o=(f[1]&c)>0?1:0,s+=c*c*(3*a^o),ae(c,f,a,o),c=c/2;return n+s}d(ze,"zxyToTileId");function bt(r){let t=0;for(let e=0;e<27;e++){let n=(1<<e)*(1<<e);if(t+n>r)return Se(e,r-t);t+=n}throw new Error("Tile zoom level exceeds max safe number limit (26)")}d(bt,"tileIdToZxy");var xt=(r=>(r[r.Unknown=0]="Unknown",r[r.None=1]="None",r[r.Gzip=2]="Gzip",r[r.Brotli=3]="Brotli",r[r.Zstd=4]="Zstd",r))(xt||{});function F(r,t){return y(this,null,function*(){if(t===1||t===0)return r;if(t===2){if(typeof globalThis.DecompressionStream>"u")return dt(new Uint8Array(r));let e=new Response(r).body;if(!e)throw new Error("Failed to read response stream");let n=e.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}d(F,"defaultDecompress");var Lt=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(Lt||{});function Re(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}d(Re,"tileTypeExt");var Tt=127;function Ie(r,t){let e=0,n=r.length-1;for(;e<=n;){let i=n+e>>1,a=t-r[i].tileId;if(a>0)e=i+1;else if(a<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||t-r[n].tileId<r[n].runLength)?r[n]:null}d(Ie,"findTile");var Et=class{constructor(t){this.file=t}getKey(){return this.file.name}getBytes(t,e){return y(this,null,function*(){return{data:yield this.file.slice(t,t+e).arrayBuffer()}})}};d(Et,"FileSource");var He=class{constructor(t,e=new Headers){this.url=t,this.customHeaders=e,this.mustReload=!1;let n="";"navigator"in globalThis&&(n=globalThis.navigator.userAgent||"");let i=n.indexOf("Windows")>-1,a=/Chrome|Chromium|Edg|OPR|Brave/.test(n);this.chromeWindowsNoCache=!1,i&&a&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(t){this.customHeaders=t}getBytes(t,e,n,i){return y(this,null,function*(){let a,o;n?o=n:(a=new AbortController,o=a.signal);let s=new Headers(this.customHeaders);s.set("range",`bytes=${t}-${t+e-1}`);let f;this.mustReload?f="reload":this.chromeWindowsNoCache&&(f="no-store");let c=yield fetch(this.url,{signal:o,cache:f,headers:s});if(t===0&&c.status===416){let u=c.headers.get("Content-Range");if(!u||!u.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let m=+u.substr(8);c=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${m-1}`}})}let h=c.headers.get("Etag");if(h!=null&&h.startsWith("W/")&&(h=null),c.status===416||i&&h&&h!==i)throw this.mustReload=!0,new te(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(c.status>=300)throw new Error(`Bad response code: ${c.status}`);let l=c.headers.get("Content-Length");if(c.status===200&&(!l||+l>e))throw a&&a.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield c.arrayBuffer(),etag:h||void 0,cacheControl:c.headers.get("Cache-Control")||void 0,expires:c.headers.get("Expires")||void 0}})}};d(He,"FetchSource");var Ut=He;function x(r,t){let e=r.getUint32(t+4,!0),n=r.getUint32(t+0,!0);return e*$(2,32)+n}d(x,"getUint64");function Pe(r,t){let e=new DataView(r),n=e.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:x(e,8),rootDirectoryLength:x(e,16),jsonMetadataOffset:x(e,24),jsonMetadataLength:x(e,32),leafDirectoryOffset:x(e,40),leafDirectoryLength:x(e,48),tileDataOffset:x(e,56),tileDataLength:x(e,64),numAddressedTiles:x(e,72),numTileEntries:x(e,80),numTileContents:x(e,88),clustered:e.getUint8(96)===1,internalCompression:e.getUint8(97),tileCompression:e.getUint8(98),tileType:e.getUint8(99),minZoom:e.getUint8(100),maxZoom:e.getUint8(101),minLon:e.getInt32(102,!0)/1e7,minLat:e.getInt32(106,!0)/1e7,maxLon:e.getInt32(110,!0)/1e7,maxLat:e.getInt32(114,!0)/1e7,centerZoom:e.getUint8(118),centerLon:e.getInt32(119,!0)/1e7,centerLat:e.getInt32(123,!0)/1e7,etag:t}}d(Pe,"bytesToHeader");function oe(r){let t={buf:new Uint8Array(r),pos:0},e=S(t),n=[],i=0;for(let a=0;a<e;a++){let o=S(t);n.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let a=0;a<e;a++)n[a].runLength=S(t);for(let a=0;a<e;a++)n[a].length=S(t);for(let a=0;a<e;a++){let o=S(t);o===0&&a>0?n[a].offset=n[a-1].offset+n[a-1].length:n[a].offset=o-1}return n}d(oe,"deserializeIndex");var _e=class extends Error{};d(_e,"EtagMismatch");var te=_e;function se(r,t){return y(this,null,function*(){let e=yield r.getBytes(0,16384);if(new DataView(e.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=e.data.slice(0,Tt),i=Pe(n,e.etag),a=e.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),o=`${r.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,s=oe(yield t(a,i.internalCompression));return[i,[o,s.length,s]]})}d(se,"getHeaderAndRoot");function le(r,t,e,n,i){return y(this,null,function*(){let a=yield r.getBytes(e,n,void 0,i.etag),o=yield t(a.data,i.internalCompression),s=oe(o);if(s.length===0)throw new Error("Empty directory is invalid");return s})}d(le,"getDirectory");var Ct=class{constructor(t=100,e=!0,n=F){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.decompress=n}getHeader(t){return y(this,null,function*(){let e=t.getKey(),n=this.cache.get(e);if(n)return n.lastUsed=this.counter++,n.data;let i=yield se(t,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(e,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(t,e,n,i){return y(this,null,function*(){let a=`${t.getKey()}|${i.etag||""}|${e}|${n}`,o=this.cache.get(a);if(o)return o.lastUsed=this.counter++,o.data;let s=yield le(t,this.decompress,e,n,i);return this.cache.set(a,{lastUsed:this.counter++,data:s}),this.prune(),s})}prune(){if(this.cache.size>this.maxCacheEntries){let t=1/0,e;this.cache.forEach((n,i)=>{n.lastUsed<t&&(t=n.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(t){return y(this,null,function*(){this.cache.delete(t.getKey())})}};d(Ct,"ResolvedValueCache");var $e=class{constructor(t=100,e=!0,n=F){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=t,this.counter=1,this.decompress=n}getHeader(t){return y(this,null,function*(){let e=t.getKey(),n=this.cache.get(e);if(n)return n.lastUsed=this.counter++,yield n.data;let i=new Promise((a,o)=>{se(t,this.decompress).then(s=>{s[1]&&this.cache.set(s[1][0],{lastUsed:this.counter++,data:Promise.resolve(s[1][2])}),a(s[0]),this.prune()}).catch(s=>{o(s)})});return this.cache.set(e,{lastUsed:this.counter++,data:i}),i})}getDirectory(t,e,n,i){return y(this,null,function*(){let a=`${t.getKey()}|${i.etag||""}|${e}|${n}`,o=this.cache.get(a);if(o)return o.lastUsed=this.counter++,yield o.data;let s=new Promise((f,c)=>{le(t,this.decompress,e,n,i).then(h=>{f(h),this.prune()}).catch(h=>{c(h)})});return this.cache.set(a,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((n,i)=>{n.lastUsed<t&&(t=n.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(t){return y(this,null,function*(){let e=t.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(t.getKey());let n=new Promise((i,a)=>{this.getHeader(t).then(o=>{i(),this.invalidations.delete(e)}).catch(o=>{a(o)})});this.invalidations.set(e,n)})}};d($e,"SharedPromiseCache");var Mt=$e,ke=class{constructor(t,e,n){typeof t=="string"?this.source=new Ut(t):this.source=t,n?this.decompress=n:this.decompress=F,e?this.cache=e:this.cache=new Mt}getHeader(){return y(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,n,i){return y(this,null,function*(){let a=ze(t,e,n),o=yield this.cache.getHeader(this.source);if(t<o.minZoom||t>o.maxZoom)return;let s=o.rootDirectoryOffset,f=o.rootDirectoryLength;for(let c=0;c<=3;c++){let h=yield this.cache.getDirectory(this.source,s,f,o),l=Ie(h,a);if(l){if(l.runLength>0){let u=yield this.source.getBytes(o.tileDataOffset+l.offset,l.length,i,o.etag);return{data:yield this.decompress(u.data,o.tileCompression),cacheControl:u.cacheControl,expires:u.expires}}s=o.leafDirectoryOffset+l.offset,f=l.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(t,e,n,i){return y(this,null,function*(){try{return yield this.getZxyAttempt(t,e,n,i)}catch(a){if(a instanceof te)return this.cache.invalidate(this.source),yield this.getZxyAttempt(t,e,n,i);throw a}})}getMetadataAttempt(){return y(this,null,function*(){let t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength,void 0,t.etag),n=yield this.decompress(e.data,t.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(n))})}getMetadata(){return y(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof te)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw t}})}getTileJson(t){return y(this,null,function*(){let e=yield this.getHeader(),n=yield this.getMetadata(),i=Re(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${t}/{z}/{x}/{y}${i}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};d(ke,"PMTiles");var be=ke;Ke();const At=Ve("pmtiles"),P="pmtilesSource",re="countryLayer",ne="regionLayer",B=[re,ne],Dt=new pt;We.addProtocol("pmtiles",Dt.tile);const E=Ge({initialZoom:0,minZoom:0,initialPosition:{lat:47.36523,lon:8.55015}});E.on("load",()=>{E.addSource(P,{type:"vector",url:`pmtiles://${At}`,attribution:"Â©OpenStreetMap contributors, Overture Maps Foundation."}),E.addLayer({id:re,source:P,type:"fill","source-layer":"division_area",filter:["==","subtype","country"],paint:{"fill-color":"lightgrey","fill-opacity":.7}}),E.addLayer({id:`${re}_outline`,source:P,type:"line","source-layer":"division_area",filter:["==","subtype","country"],paint:{"line-color":"black"}}),E.addLayer({id:ne,source:P,type:"fill","source-layer":"division_area",filter:["==","subtype","region"],paint:{"fill-color":"transparent"}}),E.addLayer({id:`${ne}_outline`,source:P,type:"line","source-layer":"division_area",filter:["==","subtype","region"],paint:{"line-color":"black","line-dasharray":[2,4],"line-width":.5}}),E.on("click",B,t=>{const e={};t.features?.forEach(n=>{const i=Ot(n.properties);e[n.layer.id]?e[n.layer.id].push(i):e[n.layer.id]=[i]}),Je(e)});const r=E.on("sourcedata",()=>{const t=E.queryRenderedFeatures({layers:B});xe(t)});E.on("move",()=>{r.unsubscribe();const t=E.queryRenderedFeatures({layers:B});xe(t)})});const xe=r=>{const t=r.reduce((e,n)=>(e[n.layer.id]!==void 0&&e[n.layer.id]++,e),Object.fromEntries(B.map(e=>[e,0])));document.getElementById("layerCount").innerText=Object.entries(t).map(e=>`${e[0]}: ${e[1]}`).join(", ")},Ot=r=>{const t={};for(const[e,n]of Object.entries(r))if(typeof n=="string")try{t[e]=JSON.parse(n)}catch{t[e]=n}else typeof n=="object"&&n!==null&&(t[e]=n);return t};
